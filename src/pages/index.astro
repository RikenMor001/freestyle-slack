---

import { useCloud } from "freestyle-sh";
import { ConversationManagerCS } from "../cloudstate/chat-manager";

const chatManager = useCloud<typeof ConversationManagerCS>("channels");


const existingChannels = await chatManager.listChannels();

if (existingChannels.length === 0) {
  return Astro.redirect("/new-channel");
}else {
  return Astro.redirect(`/channels/${existingChannels[0].id}`);
}

// const newChannel = await chatManager.createChannel("new-channel");

// return Astro.redirect(`/channels/${newChannel.id}`);
---
